<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>尼姆博弈游戏（优化版）</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffcc00;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .game-rules {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .rules-title {
            font-weight: bold;
            color: #ffcc00;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .rules-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .rules-list {
            padding-left: 20px;
            margin: 10px 0;
        }
        
        .rules-list li {
            margin-bottom: 8px;
        }
        
        .game-layout {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .player-panel {
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .player-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ff9900;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 18px;
        }
        
        .player-active {
            box-shadow: 0 0 15px #ffcc00;
            border: 2px solid #ffcc00;
        }
        
        .player-history {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
        }
        
        .history-item {
            margin-bottom: 8px;
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 14px;
        }
        
        .game-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .piles-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            flex-wrap: wrap;
            margin: 20px 0;
            min-height: 300px;
            gap: 30px;
        }
        
        .pile {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }
        
        .pile-columns {
            display: flex;
            gap: 5px;
        }
        
        .pile-column {
            display: flex;
            flex-direction: column-reverse;
        }
        
        .pile-label {
            margin-top: 10px;
            font-weight: bold;
            font-size: 18px;
            color: #ffcc00;
            text-align: center;
        }
        
        .coin {
            width: 35px;
            height: 35px;
            background: radial-gradient(circle at 30% 30%, #ffcc00, #ff9900);
            border-radius: 50%;
            margin: 2px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .coin.selected {
            background: radial-gradient(circle at 30% 30%, #ff0000, #cc0000);
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .message {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            color: #ffcc00;
        }
        
        .fade-out {
            animation: fadeOut 0.5s forwards;
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
        }
        
        .screen {
            display: none;
        }
        
        #setup-screen {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #ffcc00;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #444;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .input-hint {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .error-message {
            color: #ff6666;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        button {
            background: #ff9900;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        button:hover {
            background: #ff6600;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .mode-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .mode-buttons button {
            flex: 1;
            max-width: 200px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .selection-info {
            text-align: center;
            margin: 10px 0;
            font-size: 16px;
            color: #ffcc00;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 30px rgba(255, 153, 0, 0.5);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            min-width: 120px;
        }
        
        .win-message {
            color: #ffcc00;
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
        }
        
        #end-screen {
            text-align: center;
        }
        
        @media (max-width: 900px) {
            .game-layout {
                flex-direction: column;
            }
            
            .player-panel {
                width: 100%;
            }
            
            .piles-container {
                gap: 15px;
            }
        }
        
        @media (max-width: 600px) {
            .piles-container {
                flex-direction: row;
                align-items: flex-end;
                gap: 10px;
            }
            
            .pile {
                margin: 5px 0;
            }
            
            .mode-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-buttons button {
                max-width: 100%;
            }
            
            .modal-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>尼姆博弈游戏</h1>
        
        <div class="game-rules">
            <div class="rules-title">游戏规则</div>
            <div class="rules-content">
                <ul class="rules-list">
                    <li>游戏有若干堆棋子，玩家轮流从一堆中取走至少一个棋子</li>
                    <li>每次只能从同一堆中取棋子</li>
                    <li>每次最多可取 <span id="rules-max-take">3</span> 个棋子</li>
                    <li>可以自由选择同一堆中的任意棋子（不要求连续）</li>
                    <li>取走最后一个棋子的玩家获胜</li>
                </ul>
            </div>
        </div>
        
        <!-- 设置屏幕 -->
        <div id="setup-screen" class="screen">
            <div class="form-group">
                <label for="multi-pile-input">棋子堆设置:</label>
                <textarea id="multi-pile-input" placeholder="请输入每堆的棋子数量，用逗号分隔&#10;例如: 5,7,3,9 或只输入一堆如: 10"></textarea>
                <div class="input-hint">可以输入一堆或多堆，每堆至少3个棋子</div>
                <div class="error-message" id="multi-pile-error"></div>
            </div>
            
            <div class="form-group">
                <label for="max-take">每次最多取子数 (K):</label>
                <input type="number" id="max-take" min="1" max="10" value="3">
                <div class="input-hint">每次只能取1-K个子</div>
            </div>
            
            <div class="mode-buttons">
                <button id="pvc-mode">人机对战</button>
                <button id="pvp-mode">人人对战</button>
            </div>
        </div>
        
        <!-- 游戏屏幕 -->
        <div id="game-screen" class="screen">
            <div class="game-layout">
                <div class="player-panel" id="player1-panel">
                    <div class="player-header">
                        <div class="player-icon">P1</div>
                        <div class="player-name">玩家1</div>
                    </div>
                    <div class="player-history" id="player1-history">
                        <!-- 玩家1的操作记录 -->
                    </div>
                </div>
                
                <div class="game-area">
                    <div class="game-info">
                        <div id="player-turn">当前玩家: 玩家1</div>
                        <div id="game-mode">模式: 人机对战</div>
                        <div id="max-take-display">每次最多取: 3</div>
                    </div>
                    
                    <div class="message" id="game-message">请点击选择要拿取的棋子（可多选，但只能在同一堆中选择）</div>
                    
                    <div class="selection-info" id="selection-info">已选择: 0 个棋子 (最多可选: 3)</div>
                    
                    <div class="piles-container" id="piles-container">
                        <!-- 棋子堆将通过JS动态生成 -->
                    </div>
                    
                    <div class="action-buttons">
                        <button id="take-button">拿取所选棋子</button>
                        <button id="clear-selection-button">清除选择</button>
                        <button id="restart-button">重新开始</button>
                    </div>
                </div>
                
                <div class="player-panel" id="player2-panel">
                    <div class="player-header">
                        <div class="player-icon">P2</div>
                        <div class="player-name">玩家2</div>
                    </div>
                    <div class="player-history" id="player2-history">
                        <!-- 玩家2的操作记录 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 结束屏幕 -->
        <div id="end-screen" class="screen">
            <h2 id="winner-message" class="win-message">玩家1 获胜!</h2>
            <div class="action-buttons">
                <button id="play-again-button">再玩一次</button>
                <button id="new-game-button">新游戏</button>
            </div>
        </div>
        
        <!-- 先手选择模态框 -->
        <div id="first-player-modal" class="modal">
            <div class="modal-content">
                <h2 id="first-player-title">请选择先手玩家</h2>
                <div class="modal-buttons">
                    <button id="player1-first-button">玩家1先手</button>
                    <button id="player2-first-button">玩家2先手</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏状态变量
        let piles = [];
        let selectedCoins = new Set();
        let maxTake = 3;
        let gameMode = 'pvc';
        let currentPlayer = 1;
        let isGameOver = false;
        let currentPileIndex = -1;
        let playerHistory = {
            1: [],
            2: []
        };
        
        // DOM 元素
        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const pilesContainer = document.getElementById('piles-container');
        const playerTurnElement = document.getElementById('player-turn');
        const gameModeElement = document.getElementById('game-mode');
        const maxTakeDisplay = document.getElementById('max-take-display');
        const gameMessageElement = document.getElementById('game-message');
        const winnerMessageElement = document.getElementById('winner-message');
        const selectionInfoElement = document.getElementById('selection-info');
        const firstPlayerModal = document.getElementById('first-player-modal');
        const firstPlayerTitle = document.getElementById('first-player-title');
        const player2FirstButton = document.getElementById('player2-first-button');
        const rulesMaxTakeElement = document.getElementById('rules-max-take');
        const multiPileError = document.getElementById('multi-pile-error');
        const player1Panel = document.getElementById('player1-panel');
        const player2Panel = document.getElementById('player2-panel');
        const player1History = document.getElementById('player1-history');
        const player2History = document.getElementById('player2-history');
        
        // 初始化页面事件
        function initPageEvents() {
            // 游戏模式选择
            document.getElementById('pvc-mode').addEventListener('click', () => {
                if (validateInput()) {
                    gameMode = 'pvc';
                    initGame();
                }
            });
            
            document.getElementById('pvp-mode').addEventListener('click', () => {
                if (validateInput()) {
                    gameMode = 'pvp';
                    initGame();
                }
            });
            
            // 其他事件监听器
            document.getElementById('take-button').addEventListener('click', takeSelectedCoins);
            document.getElementById('clear-selection-button').addEventListener('click', clearSelection);
            document.getElementById('restart-button').addEventListener('click', () => {
                initGame();
            });
            document.getElementById('play-again-button').addEventListener('click', () => {
                initGame();
            });
            document.getElementById('new-game-button').addEventListener('click', () => {
                setupScreen.style.display = 'block';
                gameScreen.style.display = 'none';
                endScreen.style.display = 'none';
            });
            document.getElementById('player1-first-button').addEventListener('click', () => {
                startGame(true);
            });
            document.getElementById('player2-first-button').addEventListener('click', () => {
                startGame(false);
            });
        }
        
        // 验证输入
        function validateInput() {
            const input = document.getElementById('multi-pile-input').value;
            const piles = input.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num));
            
            if (piles.length < 1) {
                multiPileError.textContent = '至少需要一堆棋子';
                multiPileError.style.display = 'block';
                return false;
            }
            
            for (let i = 0; i < piles.length; i++) {
                if (piles[i] < 3) {
                    multiPileError.textContent = `第${i+1}堆的棋子数不能少于3`;
                    multiPileError.style.display = 'block';
                    return false;
                }
            }
            
            multiPileError.style.display = 'none';
            return true;
        }
        
        // 初始化游戏
        function initGame() {
            maxTake = parseInt(document.getElementById('max-take').value);
            
            // 更新规则显示
            rulesMaxTakeElement.textContent = maxTake;
            
            // 生成棋子堆
            const input = document.getElementById('multi-pile-input').value;
            piles = input.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num));
            
            selectedCoins.clear();
            currentPlayer = 1;
            isGameOver = false;
            currentPileIndex = -1;
            playerHistory = {1: [], 2: []};
            
            // 清空历史记录
            player1History.innerHTML = '';
            player2History.innerHTML = '';
            
            // 更新界面
            updateSelectionInfo();
            renderPiles();
            updateGameInfo();
            
            // 根据游戏模式设置先手选择模态框
            if (gameMode === 'pvc') {
                firstPlayerTitle.textContent = '请选择先手玩家';
                player2FirstButton.textContent = '电脑先手';
            } else {
                firstPlayerTitle.textContent = '请选择先手玩家';
                player2FirstButton.textContent = '玩家2先手';
            }
            
            // 显示先手选择模态框
            firstPlayerModal.style.display = 'flex';
        }
        
        // 开始游戏（选择先手后）
        function startGame(player1GoesFirst) {
            currentPlayer = player1GoesFirst ? 1 : 2;
            
            // 隐藏模态框，显示游戏屏幕
            firstPlayerModal.style.display = 'none';
            setupScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            endScreen.style.display = 'none';
            
            updateGameInfo();
            
            // 如果是AI模式且轮到AI
            if (gameMode === 'pvc' && currentPlayer === 2) {
                setTimeout(aiMove, 800);
            }
        }
        
        // 更新选择信息显示
        function updateSelectionInfo() {
            selectionInfoElement.textContent = `已选择: ${selectedCoins.size} 个棋子 (最多可选: ${maxTake})`;
            
            // 启用或禁用拿取按钮
            document.getElementById('take-button').disabled = selectedCoins.size === 0 || selectedCoins.size > maxTake;
        }
        
        // 渲染棋子堆（每堆最多7颗棋子为一列，超过则分多列）
        function renderPiles() {
            pilesContainer.innerHTML = '';
            
            piles.forEach((coins, pileIndex) => {
                const pileElement = document.createElement('div');
                pileElement.className = 'pile';
                pileElement.dataset.pileIndex = pileIndex;
                
                // 计算需要多少列（每列最多7个棋子）
                const columns = Math.ceil(coins / 7);
                const pileColumns = document.createElement('div');
                pileColumns.className = 'pile-columns';
                
                for (let col = 0; col < columns; col++) {
                    const columnElement = document.createElement('div');
                    columnElement.className = 'pile-column';
                    
                    // 当前列的棋子数量
                    const coinsInColumn = col === columns - 1 ? coins % 7 || 7 : 7;
                    
                    for (let i = 0; i < coinsInColumn; i++) {
                        const coinIndex = col * 7 + i;
                        const coinElement = document.createElement('div');
                        coinElement.className = 'coin';
                        coinElement.dataset.pileIndex = pileIndex;
                        coinElement.dataset.coinIndex = coinIndex;
                        
                        // 检查这个棋子是否被选中
                        const coinId = `${pileIndex}-${coinIndex}`;
                        if (selectedCoins.has(coinId)) {
                            coinElement.classList.add('selected');
                        }
                        
                        coinElement.addEventListener('click', () => toggleCoinSelection(pileIndex, coinIndex));
                        columnElement.appendChild(coinElement);
                    }
                    
                    pileColumns.appendChild(columnElement);
                }
                
                pileElement.appendChild(pileColumns);
                
                const pileLabel = document.createElement('div');
                pileLabel.className = 'pile-label';
                pileLabel.textContent = `${coins} 个棋子`;
                pileElement.appendChild(pileLabel);
                
                pilesContainer.appendChild(pileElement);
            });
        }
        
        // 切换棋子选择状态
        function toggleCoinSelection(pileIndex, coinIndex) {
            if (isGameOver) return;
            
            // 如果是AI回合，不允许选择
            if (gameMode === 'pvc' && currentPlayer === 2) return;
            
            const coinId = `${pileIndex}-${coinIndex}`;
            
            // 如果当前没有选择任何堆，或者选择了不同的堆
            if (currentPileIndex === -1 || currentPileIndex !== pileIndex) {
                // 清空之前的选择
                selectedCoins.clear();
                currentPileIndex = pileIndex;
            }
            
            if (selectedCoins.has(coinId)) {
                selectedCoins.delete(coinId);
                if (selectedCoins.size === 0) {
                    currentPileIndex = -1;
                }
            } else {
                // 检查是否超过最大取子数
                if (selectedCoins.size >= maxTake) {
                    gameMessageElement.textContent = `每次最多只能取 ${maxTake} 个棋子`;
                    return;
                }
                selectedCoins.add(coinId);
            }
            
            // 更新显示
            updateSelectionInfo();
            renderPiles();
        }
        
        // 清除所有选择
        function clearSelection() {
            selectedCoins.clear();
            currentPileIndex = -1;
            updateSelectionInfo();
            renderPiles();
            gameMessageElement.textContent = '已清除选择，请点击选择要拿取的棋子';
        }
        
        // 添加历史记录
        function addHistory(player, action) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.textContent = action;
            
            if (player === 1) {
                playerHistory[1].push(action);
                player1History.appendChild(historyItem);
                player1History.scrollTop = player1History.scrollHeight;
            } else {
                playerHistory[2].push(action);
                player2History.appendChild(historyItem);
                player2History.scrollTop = player2History.scrollHeight;
            }
        }
        
        // 拿取所选棋子
        function takeSelectedCoins() {
            if (isGameOver || selectedCoins.size === 0) return;
            if (selectedCoins.size > maxTake) {
                gameMessageElement.textContent = `每次最多只能取 ${maxTake} 个棋子`;
                return;
            }
            
            // 获取堆索引（所有选中的棋子应该都在同一堆）
            const pileIndex = currentPileIndex;
            
            // 播放选中棋子的消失动画
            selectedCoins.forEach(coinId => {
                const [pileIdx, coinIdx] = coinId.split('-').map(Number);
                const coinElement = document.querySelector(`.coin[data-pile-index="${pileIdx}"][data-coin-index="${coinIdx}"]`);
                if (coinElement) {
                    coinElement.classList.add('fade-out');
                }
            });
            
            // 记录玩家操作
            const action = `从第${pileIndex + 1}堆拿取了${selectedCoins.size}个棋子`;
            addHistory(currentPlayer, action);
            
            // 更新棋子堆（减少选中棋子的数量）
            piles[pileIndex] -= selectedCoins.size;
            
            // 检查游戏是否结束
            const totalCoins = piles.reduce((sum, val) => sum + val, 0);
            
            setTimeout(() => {
                if (totalCoins === 0) {
                    // 游戏结束，当前玩家获胜
                    endGame(`${gameMode === 'pvc' && currentPlayer === 2 ? '电脑' : '玩家' + currentPlayer}`);
                } else {
                    // 切换到下一个玩家
                    const previousPlayer = currentPlayer;
                    currentPlayer = currentPlayer === 1 ? 2 : 1;
                    selectedCoins.clear();
                    currentPileIndex = -1;
                    updateGameInfo();
                    
                    // 重新渲染棋子堆
                    renderPiles();
                    
                    // 如果是AI模式且轮到AI
                    if (gameMode === 'pvc' && currentPlayer === 2) {
                        setTimeout(aiMove, 800);
                    }
                }
            }, 500);
        }
        
        // AI移动
        function aiMove() {
            if (isGameOver) return;
            
            // 计算尼姆和
            let nimSum = 0;
            for (const pile of piles) {
                nimSum ^= pile % (maxTake + 1);
            }
            
            // 寻找最佳移动
            let movePile = -1;
            let moveCoins = 0;
            
            if (nimSum !== 0) {
                // 存在获胜策略
                for (let i = 0; i < piles.length; i++) {
                    if (piles[i] === 0) continue;
                    
                    const targetSize = piles[i] ^ nimSum;
                    if (targetSize < piles[i] && (piles[i] - targetSize) <= maxTake) {
                        movePile = i;
                        moveCoins = piles[i] - targetSize;
                        break;
                    }
                }
            }
            
            // 如果没有找到最佳移动，随机选择
            if (movePile === -1) {
                const nonEmptyPiles = piles.map((size, index) => size > 0 ? index : -1).filter(i => i !== -1);
                movePile = nonEmptyPiles[Math.floor(Math.random() * nonEmptyPiles.length)];
                moveCoins = Math.min(Math.floor(Math.random() * maxTake) + 1, piles[movePile]);
            }
            
            // 选择棋子（从顶部开始）
            selectedCoins.clear();
            currentPileIndex = movePile;
            for (let i = 0; i < moveCoins; i++) {
                const coinIndex = piles[movePile] - 1 - i;
                selectedCoins.add(`${movePile}-${coinIndex}`);
            }
            
            gameMessageElement.textContent = `电脑从第${movePile + 1}堆拿取了${moveCoins}个棋子`;
            
            setTimeout(() => {
                takeSelectedCoins();
            }, 1000);
        }
        
        // 更新游戏信息
        function updateGameInfo() {
            playerTurnElement.textContent = `当前玩家: ${gameMode === 'pvc' && currentPlayer === 2 ? '电脑' : '玩家' + currentPlayer}`;
            gameModeElement.textContent = `模式: ${gameMode === 'pvc' ? '人机对战' : '人人对战'}`;
            maxTakeDisplay.textContent = `每次最多取: ${maxTake}`;
            
            // 更新玩家面板状态
            player1Panel.classList.toggle('player-active', currentPlayer === 1);
            player2Panel.classList.toggle('player-active', currentPlayer === 2);
            
            if (gameMode === 'pvc' && currentPlayer === 2) {
                gameMessageElement.textContent = '电脑思考中...';
            } else {
                gameMessageElement.textContent = '请点击选择要拿取的棋子（可多选，但只能在同一堆中选择）';
            }
        }
        
        // 结束游戏
        function endGame(winner) {
            isGameOver = true;
            winnerMessageElement.textContent = `${winner} 获胜!`;
            
            gameScreen.style.display = 'none';
            endScreen.style.display = 'block';
        }
        
        // 初始化页面
        function init() {
            initPageEvents();
            updateGameInfo();
        }
        
        // 页面加载完成后初始化
        window.onload = init;
    </script>
</body>
</html>